import{_ as c,f as m,a as u,o as r,c as i,b as s,t as a,e as d,F as f,j as p,i as h,l as b}from"./index-34d007ee.js";const x={name:"UsuarioPerfil",props:["id"],data(){return{profile:null,loading:!0,error:null,showRoleModal:!1,selectedRole:"usuario"}},computed:{canEditRoles(){return m.getRole()==="admin"}},methods:{async load(){this.loading=!0,this.error=null;try{const t=await u.get(`/api/usuarios/${this.id}`);if(!t.ok){const e=await t.json().catch(()=>({}));this.error=e.error||`Error cargando perfil (${t.status})`;return}this.profile=await t.json()}catch(t){this.error=t.message||String(t)}finally{this.loading=!1}},contact(){this.profile&&this.profile.email&&(window.location.href=`mailto:${this.profile.email}`)},openChangeRole(){this.selectedRole=this.profile.roles&&this.profile.roles.includes("entrenador")?"entrenador":this.profile.roles.includes("cliente")?"cliente":"usuario",this.showRoleModal=!0},closeRoleModal(){this.showRoleModal=!1},async submitRole(){try{const t=await u.post(`/api/admin/usuarios/${this.profile.id}/set_role`,{role:this.selectedRole});if(!t.ok){const e=await t.json().catch(()=>({}));alert(e.error||"Error cambiando rol");return}this.showRoleModal=!1,await this.load(),this.$root.$emit("refresh-metrics")}catch(t){alert(t.message||String(t))}}},mounted(){this.load()}},g={class:"flex items-center justify-between"},v={key:0,class:"mt-4 text-gray-500"},y={key:1,class:"mt-4 text-red-600"},R={key:2,class:"mt-4 bg-white rounded shadow p-6"},w={class:"mb-4"},k={class:"text-xl font-bold"},_={class:"mb-4"},C={class:"text-sm"},j=["href"],M={class:"mb-4"},E={class:"text-sm"},S={key:0,class:"mb-4"},U={class:"text-sm"},V={key:1,class:"mb-4"},B={class:"list-disc pl-5 text-sm"},N={class:"mt-6"},P={key:2,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-40"},D={class:"bg-white rounded shadow-lg w-80 p-4"},F={class:"flex justify-end"};function G(t,e,L,q,o,n){return r(),i("div",null,[s("div",g,[e[6]||(e[6]=s("h2",{class:"text-lg font-semibold"},"Perfil de usuario",-1)),s("button",{onClick:e[0]||(e[0]=l=>t.$router.back()),class:"px-3 py-2 border rounded"},"Volver")]),o.loading?(r(),i("div",v,"Cargando perfil...")):o.error?(r(),i("div",y,a(o.error),1)):(r(),i("div",R,[s("div",w,[e[7]||(e[7]=s("div",{class:"text-sm text-gray-500"},"Nombre",-1)),s("div",k,a(o.profile.nombre),1)]),s("div",_,[e[8]||(e[8]=s("div",{class:"text-sm text-gray-500"},"Email",-1)),s("div",C,[s("a",{href:`mailto:${o.profile.email}`,class:"text-blue-600 hover:underline"},a(o.profile.email),9,j)])]),s("div",M,[e[9]||(e[9]=s("div",{class:"text-sm text-gray-500"},"Roles",-1)),s("div",E,a(o.profile.roles.join(", ")||"usuario"),1)]),o.profile.entrenador?(r(),i("div",S,[e[10]||(e[10]=s("div",{class:"text-sm text-gray-500"},"Especialidad",-1)),s("div",U,a(o.profile.entrenador.speciality||"—"),1)])):d("",!0),o.profile.rutinas&&o.profile.rutinas.length?(r(),i("div",V,[e[11]||(e[11]=s("div",{class:"text-sm text-gray-500"},"Rutinas (últimas)",-1)),s("ul",B,[(r(!0),i(f,null,p(o.profile.rutinas,l=>(r(),i("li",{key:l.id},a(l.nombre),1))),128))])])):d("",!0),s("div",N,[s("button",{onClick:e[1]||(e[1]=(...l)=>n.contact&&n.contact(...l)),class:"px-3 py-2 bg-green-600 text-white rounded mr-2"},"Contactar por email"),n.canEditRoles?(r(),i("button",{key:0,onClick:e[2]||(e[2]=(...l)=>n.openChangeRole&&n.openChangeRole(...l)),class:"px-3 py-2 border rounded"},"Cambiar rol")):d("",!0)]),o.showRoleModal?(r(),i("div",P,[s("div",D,[e[13]||(e[13]=s("h3",{class:"text-lg font-semibold mb-2"},"Cambiar rol",-1)),h(s("select",{"onUpdate:modelValue":e[3]||(e[3]=l=>o.selectedRole=l),class:"w-full border rounded px-2 py-1 mb-3"},[...e[12]||(e[12]=[s("option",{value:"cliente"},"Cliente",-1),s("option",{value:"entrenador"},"Entrenador",-1),s("option",{value:"usuario"},"Usuario",-1)])],512),[[b,o.selectedRole]]),s("div",F,[s("button",{onClick:e[4]||(e[4]=(...l)=>n.closeRoleModal&&n.closeRoleModal(...l)),class:"mr-2 px-3 py-2 border rounded"},"Cancelar"),s("button",{onClick:e[5]||(e[5]=(...l)=>n.submitRole&&n.submitRole(...l)),class:"px-3 py-2 bg-blue-600 text-white rounded"},"Guardar")])])])):d("",!0)]))])}const A=c(x,[["render",G]]);export{A as default};
