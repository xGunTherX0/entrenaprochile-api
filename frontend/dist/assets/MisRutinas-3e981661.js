import{_ as y,a as f,o as a,c as r,b as n,e as d,i as g,v,F as x,j as b,t as l,n as w,d as c}from"./index-34d007ee.js";const k={name:"MisRutinas",data(){return{misRutinas:[],loading:!1,searchQuery:"",localSavedRutinas:[],expanded:{}}},methods:{async fetchMisRutinas(){this.loading=!0,this.misRutinas=[];try{const i=await f.get("/api/rutinas/mis");i&&i.ok&&(this.misRutinas=await i.json());try{const e=await f.get("/api/solicitudes/mis");if(e&&e.ok){const o=await e.json(),_=Array.isArray(o)?o.filter(u=>u&&(()=>{const s=Number(u.rutina_id);return!isNaN(s)&&s>0})()):[];for(let u=0;u<_.length;u++){const s=_[u],t=Number(s.rutina_id);isNaN(t)||t<=0||this.misRutinas.find(m=>{const p=Number(m.real_rutina_id||m.id);return!isNaN(p)&&p===t})||this.misRutinas.push({id:`solicitud-${s.id}`,real_rutina_id:s.rutina_id,nombre:s.rutina_nombre||"Rutina "+s.rutina_id,descripcion:s.nota||"",solicitud_id:s.id,estado:s.estado||"pendiente"})}}}catch(e){console.error("fetch solicitudes for mis rutinas failed",e)}try{const e=JSON.parse(localStorage.getItem("saved_rutinas")||"[]");this.localSavedRutinas=Array.isArray(e)?e:[]}catch{this.localSavedRutinas=[]}}catch(i){console.error("fetchMisRutinas",i)}finally{this.loading=!1}},openRutinaDetail(i){i&&this.$router.push(`/cliente/rutina/${i}`)},async unfollowRutina(i){if(i&&confirm("¿Eliminar esta rutina guardada?"))try{const e=await f.del(`/api/rutinas/${i}/seguir`);if(e&&e.ok)this.misRutinas=this.misRutinas.filter(o=>o.id!==i);else{let o={};try{o=await e.json()}catch{}throw new Error(o.error||"Error eliminando rutina guardada")}}catch(e){console.error("unfollowRutina failed",e);try{alert("No se pudo eliminar la rutina guardada: "+(e.message||e))}catch{}}},async cancelSolicitud(i){if(i&&confirm("¿Seguro que quieres cancelar esta solicitud?"))try{const e=await f.del(`/api/solicitudes/${i}`);if(e&&e.ok){this.misRutinas=(this.misRutinas||[]).filter(o=>o.solicitud_id!==i);try{alert("Solicitud cancelada")}catch{}}else{const o=await e.json().catch(()=>({}));throw new Error(o.error||"Error cancelando solicitud")}}catch(e){console.error("cancelSolicitud failed",e);try{alert("No se pudo cancelar la solicitud: "+(e.message||e))}catch{}}},toggleExpand(i){this.expanded=Object.assign({},this.expanded,{[i]:!this.expanded[i]})},isExpanded(i){return!!this.expanded[i]},canView(i){try{if(!i)return!1;if(i.solicitud_id){const e=(i.estado||"").toString().toLowerCase();return e==="aceptado"||e==="accepted"}return!0}catch{return!1}}},computed:{filteredRutinas(){const i=(this.searchQuery||"").trim().toLowerCase();return i?(this.misRutinas||[]).filter(e=>(e.nombre||"").toLowerCase().includes(i)||(e.descripcion||"").toLowerCase().includes(i)||(e.nivel||"").toLowerCase().includes(i)):this.misRutinas||[]}},mounted(){this.fetchMisRutinas()}},R={class:"p-6"},C={class:"bg-white p-4 rounded shadow"},N={class:"flex items-center justify-between mb-4"},E={key:0},S={class:"w-1/3"},j={key:0},V={key:0,class:"text-sm text-gray-600"},q={class:"mt-2 space-y-2"},M={class:"flex justify-between items-start"},L=["onClick"],D={class:"font-semibold"},A={class:"text-sm text-gray-600"},B={key:0,class:"text-sm text-yellow-700"},Q={class:"space-x-2"},F=["disabled","onClick","title"],O=["onClick"],z=["onClick"],T={key:0,class:"mt-3 p-3 bg-gray-50 rounded text-sm text-gray-700"},G={key:0},J={key:1},U={key:2},H={key:3},K={key:4},P={key:5},W={key:6},X={key:7},Y={key:8},Z=["href"];function I(i,e,o,_,u,s){return a(),r("div",R,[e[11]||(e[11]=n("h1",{class:"text-2xl font-bold mb-4"},"Mis Rutinas Guardadas",-1)),n("div",C,[n("div",N,[u.loading?(a(),r("div",E,"Cargando tus rutinas guardadas...")):d("",!0),n("div",S,[g(n("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>u.searchQuery=t),placeholder:"Buscar rutinas...",class:"w-full px-3 py-2 border rounded"},null,512),[[v,u.searchQuery]])])]),u.loading?d("",!0):(a(),r("div",j,[s.filteredRutinas.length===0?(a(),r("div",V,"No tienes rutinas guardadas.")):d("",!0),n("ul",q,[(a(!0),r(x,null,b(s.filteredRutinas,t=>(a(),r("li",{key:t.id,class:"p-3 border rounded bg-white"},[n("div",M,[n("div",{onClick:h=>s.toggleExpand(t.id),class:"cursor-pointer"},[n("div",D,l(t.nombre),1),n("div",A,l(t.descripcion),1),t.solicitud_id?(a(),r("div",B,"Estado: "+l(t.estado||"pendiente"),1)):d("",!0)],8,L),n("div",Q,[n("button",{disabled:!s.canView(t),onClick:h=>s.openRutinaDetail(t.real_rutina_id||t.id),title:s.canView(t)?"Ver":"El entrenador no ha autorizado ver esta rutina",class:w(["px-3 py-1 rounded",s.canView(t)?"bg-blue-600 text-white":"bg-gray-300 text-gray-600 cursor-not-allowed"])}," Ver ",10,F),t.solicitud_id?(a(),r("button",{key:0,onClick:h=>s.cancelSolicitud(t.solicitud_id),class:"px-3 py-1 bg-red-600 text-white rounded"},"Cancelar solicitud",8,O)):(a(),r("button",{key:1,onClick:h=>s.unfollowRutina(t.id),class:"px-3 py-1 bg-red-600 text-white rounded"},"Eliminar",8,z))])]),s.isExpanded(t.id)?(a(),r("div",T,[t.objetivo_principal?(a(),r("div",G,[e[1]||(e[1]=n("strong",null,"Objetivo principal:",-1)),c(" "+l(t.objetivo_principal),1)])):d("",!0),t.enfoque_rutina?(a(),r("div",J,[e[2]||(e[2]=n("strong",null,"Enfoque:",-1)),c(" "+l(t.enfoque_rutina),1)])):d("",!0),t.cualidades_clave?(a(),r("div",U,[e[3]||(e[3]=n("strong",null,"Cualidades clave:",-1)),c(" "+l(t.cualidades_clave),1)])):d("",!0),t.duracion_frecuencia?(a(),r("div",H,[e[4]||(e[4]=n("strong",null,"Duración / Frecuencia:",-1)),c(" "+l(t.duracion_frecuencia),1)])):d("",!0),t.material_requerido?(a(),r("div",K,[e[5]||(e[5]=n("strong",null,"Material requerido:",-1)),c(" "+l(t.material_requerido),1)])):d("",!0),t.instrucciones_estructurales?(a(),r("div",P,[e[6]||(e[6]=n("strong",null,"Instrucciones:",-1)),c(" "+l(t.instrucciones_estructurales),1)])):d("",!0),t.seccion_descripcion?(a(),r("div",W,[e[7]||(e[7]=n("strong",null,"Descripción:",-1)),c(" "+l(t.seccion_descripcion),1)])):d("",!0),t.nivel?(a(),r("div",X,[e[8]||(e[8]=n("strong",null,"Nivel:",-1)),c(" "+l(t.nivel),1)])):d("",!0),t.link_url?(a(),r("div",Y,[e[9]||(e[9]=n("strong",null,"Link:",-1)),e[10]||(e[10]=c()),n("a",{href:t.link_url,target:"_blank",class:"text-blue-600"},l(t.link_url),9,Z)])):d("",!0)])):d("",!0)]))),128))])]))])])}const ee=y(k,[["render",I]]);export{ee as default};
