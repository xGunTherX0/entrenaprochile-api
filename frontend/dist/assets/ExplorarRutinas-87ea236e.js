import{_ as m,a as h,k as y,r as f,o as l,c as d,b as n,i as x,v,n as p,F as _,j as g,t as c,g as w,w as R,d as k}from"./index-34d007ee.js";const S={name:"ExplorarRutinas",data(){return{explorarRutinas:[],loading:!1,searchQuery:"",selectedTrainerId:null,page:1,pageSize:6,savingFollowIds:[],requestedRutinaIds:[],localSavedRutinas:[]}},computed:{trainers(){const t=Array.isArray(this.explorarRutinas)?this.explorarRutinas:[],e={};for(let i=0;i<t.length;i++){const r=t[i],a=r&&(r.entrenador_id!=null?r.entrenador_id:"_"+(r.entrenador_nombre||""));e[a]||(e[a]={entrenador_id:r?r.entrenador_id:null,entrenador_nombre:r?r.entrenador_nombre:null,entrenador_id_usuario:r?r.entrenador_usuario_id:null})}return Object.keys(e).map(i=>e[i])},filteredRutinas(){let t=Array.isArray(this.explorarRutinas)?this.explorarRutinas.slice():[];if(this.selectedTrainerId&&(t=t.filter(e=>e&&e.entrenador_id===this.selectedTrainerId)),this.searchQuery&&this.searchQuery.trim().length>0){const e=this.searchQuery.trim().toLowerCase();t=t.filter(i=>i&&((i.nombre||"").toLowerCase().includes(e)||(i.nivel||"").toLowerCase().includes(e)||(i.descripcion||"").toLowerCase().includes(e)))}return t},totalPages(){return Math.max(1,Math.ceil((this.filteredRutinas||[]).length/this.pageSize))},paginatedRutinas(){const t=(this.page-1)*this.pageSize;return(this.filteredRutinas||[]).slice(t,t+this.pageSize)}},methods:{onSearch(){this.page=1},selectTrainer(t){this.selectedTrainerId=t,this.page=1},async fetchRutinasPublicas(){this.loading=!0,this.explorarRutinas=[];try{const t=await h.get("/api/rutinas/public",{skipAuth:!0}),e=await t.json();t&&t.ok&&(this.explorarRutinas=e);try{const i=JSON.parse(localStorage.getItem("saved_rutinas")||"[]");this.localSavedRutinas=Array.isArray(i)?i:[]}catch{this.localSavedRutinas=[]}}catch(t){console.error("fetchRutinasPublicas",t)}finally{this.loading=!1}},async fetchMisSolicitudes(){try{const t=await h.get("/api/solicitudes/mis");if(t&&t.ok){const e=await t.json();this.requestedRutinaIds=Array.isArray(e)?e.filter(i=>i&&(()=>{const r=Number(i.rutina_id);return!isNaN(r)&&r>0&&(i.estado==="pendiente"||i.estado==="aceptado")})()).map(i=>Number(i.rutina_id)):[]}}catch{}},openRutinaDetail(t){t&&this.$router.push(`/cliente/rutina/${t}`)},async followRutina(t){return this.solicitarRutina(t)},async solicitarRutina(t){if(t)try{const e=await h.post(`/api/rutinas/${t}/solicitar`,{}),i=await e.json();if(!e.ok)throw new Error(i.error||"Error solicitando rutina");try{const r=i.estado||"pendiente";(r==="pendiente"||r==="aceptado")&&!this.requestedRutinaIds.includes(t)&&this.requestedRutinaIds.push(t)}catch{}try{this.$router.push("/cliente/misrutinas")}catch{}try{(await y(()=>import("./index-34d007ee.js").then(r=>r.m),["assets/index-34d007ee.js","assets/index-bd263dab.css"])).default.show("Solicitud creada. Revisa Mis Rutinas para ver el estado.",3e3)}catch{alert("Solicitud creada")}}catch(e){console.error("solicitarRutina failed",e);try{alert("No se pudo solicitar el plan: "+(e.message||e))}catch{}}}},async mounted(){this.explorarRutinas.length||await this.fetchRutinasPublicas(),await this.fetchMisSolicitudes()}},C={class:"p-6"},I={class:"bg-white p-4 rounded shadow"},T={class:"flex items-center justify-between mb-4"},A={class:"w-1/3"},E={class:"w-60 trainer-list"},j={class:"space-y-2"},N=["onClick"],P={key:0,class:"bg-white p-4 rounded shadow"},D={key:1},q={key:0,class:"bg-white p-4 rounded shadow"},L={key:1,class:"bg-white p-4 rounded shadow"},V={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"},M={class:"flex justify-between items-start"},Q=["onClick"],z={class:"text-sm text-gray-600"},F={class:"text-xs text-gray-500"},B={class:"mt-3 text-sm text-gray-700"},O={class:"mt-4 flex items-center justify-between"},J={class:"space-x-2"},U=["onClick"],G=["disabled","onClick"],H={class:"mt-4 flex items-center justify-center space-x-2"},K=["disabled"],W=["disabled"];function X(t,e,i,r,a,o){const b=f("router-link");return l(),d("div",C,[e[7]||(e[7]=n("h1",{class:"text-2xl font-bold mb-4"},"Explorar Rutinas",-1)),n("div",I,[n("div",T,[n("div",A,[x(n("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>a.searchQuery=s),onInput:e[1]||(e[1]=(...s)=>o.onSearch&&o.onSearch(...s)),placeholder:"Buscar por nombre o nivel...",class:"w-full px-3 py-2 border rounded"},null,544),[[v,a.searchQuery]])]),n("aside",E,[e[6]||(e[6]=n("h3",{class:"font-semibold mb-2"},"Entrenadores",-1)),n("div",j,[n("button",{class:p([{"font-semibold text-blue-600":a.selectedTrainerId===null},"px-2 py-1 rounded bg-gray-50 w-full text-left"]),onClick:e[2]||(e[2]=s=>o.selectTrainer(null))},"Todos",2),(l(!0),d(_,null,g(o.trainers,s=>(l(),d("div",{key:s.entrenador_id,class:"flex items-center justify-between"},[n("button",{onClick:u=>o.selectTrainer(s.entrenador_id),class:p([{"font-semibold text-blue-600":a.selectedTrainerId===s.entrenador_id},"px-2 py-1 rounded bg-gray-50 w-full text-left"])},c(s.entrenador_nombre||"—"),11,N),w(b,{to:{name:"EntrenadorPublico",params:{id:s.entrenador_id_usuario||s.entrenador_id}},class:"ml-2 text-sm text-blue-600"},{default:R(()=>[...e[5]||(e[5]=[k("Ver perfil",-1)])]),_:1},8,["to"])]))),128))])])]),a.loading?(l(),d("div",P,"Cargando rutinas...")):(l(),d("div",D,[a.explorarRutinas.length===0?(l(),d("div",q,"No hay rutinas públicas disponibles.")):(l(),d("div",L,[n("div",V,[(l(!0),d(_,null,g(o.paginatedRutinas,s=>(l(),d("div",{key:s.id,class:"bg-white border rounded p-4 shadow hover:shadow-md"},[n("div",M,[n("div",null,[n("h3",{class:"font-semibold text-lg cursor-pointer",onClick:u=>o.openRutinaDetail(s.id)},c(s.nombre),9,Q),n("div",z,c(s.nivel)+" • "+c(s.entrenador_nombre||"—"),1)]),n("div",F,c(s.creado_en?new Date(s.creado_en).toLocaleDateString():""),1)]),n("p",B,c(s.descripcion),1),n("div",O,[n("div",J,[n("button",{onClick:u=>o.openRutinaDetail(s.id),class:"px-3 py-1 bg-blue-600 text-white rounded"},"Ver",8,U)]),n("button",{disabled:a.savingFollowIds.includes(s.id)||a.requestedRutinaIds.includes(s.id),onClick:u=>o.solicitarRutina(s.id),class:"px-3 py-1 bg-green-600 text-white rounded"},c(a.savingFollowIds.includes(s.id)?"Enviando...":a.requestedRutinaIds.includes(s.id)?"Solicitud pendiente":"Solicitar rutina"),9,G)])]))),128))]),n("div",H,[n("button",{disabled:a.page<=1,onClick:e[3]||(e[3]=s=>a.page--),class:"px-3 py-1 border rounded"},"Anterior",8,K),n("div",null,"Página "+c(a.page)+" / "+c(o.totalPages),1),n("button",{disabled:a.page>=o.totalPages,onClick:e[4]||(e[4]=s=>a.page++),class:"px-3 py-1 border rounded"},"Siguiente",8,W)])]))]))])])}const Z=m(S,[["render",X]]);export{Z as default};
